;eff is the detector efficiency and is dimensional less, it varies
;with time as the gain for the detectors and detector operational
;voltage is adjusted


;aeff is the effective area and has cm^2 units


;_________________________________________________________________
;____Use the Date and Time of Interest to find the detector efficience
;____       eff and the spacecraft speed. 11/01/2008 18:17:38.734331
;_________________________________________________________________
idate='11/01/2008'
itime='18:17:38.734331'
CONVERT_DATE_TIME_TO_YEAR_ARR,idate,itime,it_str
ilab=idate + ' ' +itime

;_________________________________________________
;____Find Spacecraft Speed Along Radial Direction
;_________________________________________________
;____Load the trajectory information to find the speed
;_________________________________________________
traj_file=file_path+traj_file
ext_names=['NH_HGI_']
READ_TRAJ, ext_names, traj_file,old_ext_names, traj_data,time_traj
traj_met=double(strmid(traj_data.nh_hgi_d.met,2,10)) +2.d*double(strmid(traj_data.nh_hgi_d.met,13,5))/1D5
st_met=double(interpol(traj_met, time_traj.tyrr, st.tyrr))
sp_met=double(interpol(traj_met, time_traj.tyrr, sp.tyrr))
i_et=double(interpol(traj_met, time_traj.tyrr, it_str.tyrr))
plot_label=plot_label +'MET: '+strcompress(string(st_met,format='(F17.2)'),/remove_all)+ ' to ' + strcompress(string(sp_met,format='(F17.2)'),/remove_all)
;_________________________________________________
;___Calculate the speed along the sun-spaceraft
;___   vector (radial speed) for interplated values
;__________________________________________________
is=where( traj_data.nh_hgi_d.r gt 0)
vr_all=dblarr(n_elements(traj_data.NH_HGI_D))
vmag_all=dblarr(n_elements(traj_data.NH_HGI_D))
vr_all(*)=-1000000.0
vmag_all(*)=-1000000.0
for i=0L, n_elements(traj_data.NH_HGI_D)-1L do begin
  if traj_data.nh_hgi_d(i).x gt -1000000.0 then begin
    v_temp=[traj_data.nh_hgi_d(i).vx,traj_data.nh_hgi_d(i).vy,traj_data.nh_hgi_d(i).vz]
    vmag_all(i)=sqrt(v_temp(0)^2+v_temp(1)^2+v_temp(2)^2)
    x_temp=[traj_data.nh_hgi_d(i).x,traj_data.nh_hgi_d(i).y,traj_data.nh_hgi_d(i).z]
    xmag=sqrt(x_temp(0)^2+x_temp(1)^2+x_temp(2)^2)
    vr_all(i)=transpose(v_temp)#x_temp/xmag
  endif
endfor 

;__________________________________________
;___ Find the speed for the time of interest 11/01/2008 18:17:38.734331
;__________________________________________
it_vr=interpol( vr_all(is),time_traj(is).tyrr, it_str.tyrr) 
;------------------------------------------------------------

;_________________________________________________________________
;______Load Example Measured energies and elapsed times at 11/01/2008 18:17:38.734331
;__________________________________________________________________
LOAD_EXAMPLE, einst, st_et, sp_et



restore,'fin_arr_ebea_ang_eb_bg_corr.sav'
restore,'w_phi.sav'

;input the speed of the particle, and incident angles with respect to
;the instrument look direction.

v = 50+findgen(100)*10 ;km/s
theta = 1.2 ;degrees
phi = 35.   ;degress
eff = 1.0   ;????

r = 0.0
for i = 0,n_elements(v)-1 do begin
   res = get_swap_resp(v(i),theta,phi,wphi,s4,eff)
   r = [r,res]
   print,'SWAP response...',res
endfor

p=plot(v,r(1:*),ytitle='$w(E,\theta)p(\phi)A_{eff}$',xtitle='E/q (eV)')

end
